[tox]
envlist = py311,py312,py313,lint,type
isolated_build = True

[testenv]
deps =
    pytest>=7
    pytest-asyncio>=0.21
    pytest-cov>=4
extras = dev
commands =
    pytest tests/ -v --cov=trestle_coordinator_core --cov-report=term --cov-report=xml

[testenv:lint]
deps =
    ruff>=0.6
skip_install = True
commands =
    ruff check trestle_coordinator_core/ tests/

[testenv:type]
deps =
    mypy>=1.8
    pytest>=7
commands =
    mypy trestle_coordinator_core/

[testenv:format]
deps =
    ruff>=0.6
skip_install = True
commands =
    ruff format trestle_coordinator_core/ tests/
    ruff check --fix trestle_coordinator_core/ tests/

[testenv:security]
deps =
    bandit>=1.7
skip_install = True
commands =
    bandit -r trestle_coordinator_core/ -x trestle_coordinator_core/trestle_pb2.py
